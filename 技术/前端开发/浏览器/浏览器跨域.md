---
aliases: [同源策略网络, 浏览器跨域]
tags: [浏览器跨域]
date created: 2022-06-20 21:17:45
date updated: 2022-12-29 16:12:45
title: 同源策略网络
---

# 浏览器跨域

## 同源策略网络

| 说明           | 是否允许通讯 |
| ------------ | ------ |
| 同一域名，不同文件或路径 | 允许     |
| 同一域名，不同端口    | 不允许    |
| 同一域名，不同协议    | 不允许    |
| 域名和域名对应 ip   | 不允许    |
| 域相同，子域不同     | 不允许    |
| 不同域名         | 不允许    |

## 解决方法

### JSONP

- script 标签不受跨域限制
- 前端定义 callback（回调函数）src 接受执行挂有数据的 callback 方法。

#### 前端

```html
  <!-- 前端 -->
  <script>
      window.callback = function (res) {
          console.log(res)
      }
  </script>
  <script src='http://localhost:80/callback.js'></script>
```

#### 后端

后端通过触发 callback 向前端传输数据

```javascript
 callback({
     data:'我是后端的数据'
 })
```

### 跨域资源共享（CORS）

- W3C 标准，它允许浏览器像跨域的服务器发送 AJAX 请求，兼容浏览器 IE10+
- 需要满足下列条件：
  - 使用下列请求方式之一
    - `GET`
    - `POST`
    - `HEAD`
  - `Content-Type` 的值仅限于下列三者之一：
    - `text/plain`
    - `multipart/form-data`
    - `application/x-www-form-urlencoded`
  - 请求中的任意 `XMLHttpRequestUpload` 对象均没有注册任何事件监听器；`XMLHttpRequestUpload` 对象可以使用 `XMLHttpRequest.upload` 属性访问。
  - 请求中没有使用 `ReadableStream` 对象。
  - Fetch 规范定义了 [对 CORS 安全的首部字段集合](https://fetch.spec.whatwg.org/[[cors-safelisted-request-header]]) ，不得人为设置该集合之外的其他首部字段。该集合为：
    - `Accept`
    - `Accept-Language`
    - `Content-Language`
    - `Content-Type` （需要注意额外的限制）
    - `DPR`
    - `Downlink`
    - `Save-Data`
    - `Viewport-Width`
    - `Width`

### 本地代理 (前端工程化工具 `WEBAPCK`|`VITE` 等)

- 使用本地接受后端数据
- 数据转发到本地接口
- node 中间件和 nginx 以及 VPN 翻墙类基本同理

### NGINX 代理跨域

- 通过 nginx 代理跨域
- 配置 nginx.conf

```nginx
  server {
      listen 80;
      server_name localhost;
      location / {
          proxy_pass http://localhost:8080;
      }
  }
```

### NODE 中间件代理

### POSTMESSAGE 跨域

### WEBSOCKET 协议跨域

### DOCUMENT.DOMAIN + IFRAME 跨域

### LOCATION.HASH + IFRAME 跨域

### WINDOW.NAME + IFRAME 跨域
